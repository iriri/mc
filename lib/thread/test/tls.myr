use std
use sys
use thread

var key
var wg

const foo = {
	thread.tlsset(key, (thread.tid() : void#))
	var p : void# = thread.tlsget(key)
	std.put("{}\n", p)
	thread.wgpost(&wg)
}

const main = {
	key = thread.tlsreg()
	wg = thread.mkwg(4)

	foo()
	thread.spawn(foo)
	thread.spawn(foo)
	thread.spawn(foo)

	thread.wgwait(&wg)
}
